THE PLAN:

user runs bookmarklet

bookmarklet adds comments to dom

bookmarklet adds iframe (graffidia.com/remote_login) to dom

remote_login checks cookie

if bad, require login

iframe makes ajax request to graffidia.com/login to authenticate

if good, generate access_token and save it to user object

return access token to iframe

iframe postMessage to 3rd party site with access token

3rd party site makes initial socket.io call with access token that backend uses to associate socket id with access_token/user in mongo

3rd party site includes access token in every socket.io call

backend: on socket call, identify user by the provided access token

backend: on socket disconnect, remove socket id and access token from user object in mongo